# <center>计算机网络知识点</center>

[toc]



### 物理层

功能    在物理媒介上透明传输位流

### 数据链路层

功能   相邻节点间无差错的传送帧

##### 	1.PPP(点对点通信协议)

​		帧 ： 由帧首开始中间封装数据，后面加上帧尾，组成的一个数据单元称为帧。

###### 		封装成帧  

​				发送方的工作  帧首部和尾部的一个重要作用就是帧定界  SOH帧首 EOT帧尾

###### 		透明传输

​				对数据中可能出现的控制字符 SOH EOT 进行转义

###### 		差错控制  接收方

​				判断收到的帧是否有错误

​				比特差错  循环冗余检验(CRC)

​				帧差错

##### 	2.HDLC(高级数据链路控制协议) 

​		HDLC协议用以保证传送到下一层的数据在传输过程中能够准确地被接收，也就是		差错释放中没有任何损失，并且序列正确。HDLC协议的另一个重要功能是流量控		制，即一旦接收端收到数据，便能立即进行传输。

##### 	3.CSMA/CD协议(载波监听，多点介入，碰撞检测协议)

###### 		主要功能 碰撞检测  如果争取期内没有发生碰撞那么本次传输不会发生碰撞

​		阶段二进制指数退避算法:  随机延迟后，继续载波监听

##### 	4.以太网   满足IEEE802.3标准的都是以太网

###### 		VLAN  广播风暴

​			广播风暴产生原因: 不合理的网络划分(导致网络之的广播包特别多造成广播风暴), 形成环路 数据包重复发送

##### 	5.网桥   

###### 			作用 根据mac帧的目的地址，对收到的帧进行转发，同时过滤帧，通过学习记录mac地址

​			网桥内部结构 ： 站表， 缓存， 接口

​			透明网桥   自学习+转发   自学习 使用生成树算法

### 网络层

​	功能  主机到主机之间的通信   分组传输，路由选择，流量控制，

##### 	1. IP(网际协议) 

​		功能：无连接数据包传送，数据路由选择和差错控制

​		特点： 无连接，不可靠，只能尽力传送   不保证数据的到达。

##### 	2 .ARP(地址解析协议)

​		功能  IP地址到mac地址的解析

###### 		工作原理

			* 主机A确定要送的主机B的IP地址，首先查询本地ARP缓存表，如果没有匹配到mac地址，就向本地网络的所有主机广播ARP请求包 请求包包含主机A的IP地址和mac地址
			* 本地网络的其他主机收到ARP请求后，进行匹配，不匹配就丢弃。
			* 主机B匹配成功后将主机A的IP地址和mac地址添加到自己的本地路由表中。
			* 主机B直接向主机A发送包含自己IP地址和mac地址的ARP请求。
			* 主机A收到请求后将其添加到自己的ARP缓存表中。
			* 如果本地缓存失效，就重复上述过程。

##### 3. 分组转发过程  32位相“与”运算

​	1.从收到的分组提取目的IP地址D

​	2.用直接相连的个网络的子网掩码与D逐位相与，若匹配，则直接交付分组，否则执行3

​	3.若路由表有D的特定主机路由，则将分组传送给下一跳路由器，否则执行4

​	4.对路由表的每一行子网掩码和D逐位相与，若匹配则将分组传送给该行指明的吓一跳路由器

	5. 查找默认路由，否则执行6
 	6. 报告分组转发出错。

##### 4 ICMP(网际控制报文协议)

​	功能： ip主机和路由器之间传递控制消息

​	TCP/IP协议族的子协议  报告错误 本身出错并不会报告

​	主要用于 差错报告(目的站不可达，源站抑制，超时，参数问题，重定向)

##### 5.RIP(分布式的基于距离向量的路由选择协议)

###### 	工作原理

		* 仅仅和相邻的路由器交换信息
		* 交换的信息是自己的路由表
		* 按固定的时间间隔交换路由信息

##### 6.IGMP(internet组管理协议)

​	功能 运行在组播路由器和主机之间  用于主机和多播路由器之间的请求和探询， TCP/IP协议族。

### 传输层

* 套接字 socket(ip+port)

 		功能 进程间通信  为相互通信的应用进程提供了端到端的逻辑通信服务

##### 1.UDP协议 (用户数据报协议)

* 功能 向应用层提供无连接的数据报交互服务
* 特点
  * 无连接  发送数据之前不需要建立连接，资源消耗小，处理速度块
  * 尽最大努力交付 不保证可靠交付，同时也不使用拥塞控制，适合多媒体通信
  * 面向报文 支持 1：1  1：n n:m  m:1 通信
  * 应用 视频传输 实时通信 QQ

##### 2.TCP协议(传输控制协议)

* 功能 向应用层体统面向连接的可靠的数据流服务
* 特点
  * 面向连接  
  * 点对点通信
  * 可靠交付
  * 全双工通信
  * 面向字节流  （8位二进制代表一个字符/字节)

##### TCP 三次握手

* ![image-20200227212834048](C:\Users\HYY\AppData\Roaming\Typora\typora-user-images\image-20200227212834048.png)

* TCP建立连接为什么一定要握手三次?
  * **防止已失效的连接请求报文突然有传送到了服务端，因而产生错误**。有可能客户端之前发出的请求报文由于在网络之滞留，以致到连接释放以后的某个时间才到server，这是server误以为客户端发起连接请求，向客户端发送确认数据包同意建立连接，但是客户端并未发出连接请求，就对服务端发来的确认不理会，server一直等待client的请求，造成服务端资源浪费。
  * 但3次握手的话就不会产生这种情况。
* TCP如何保证可靠性：
  * 确认机制
    * 1.无差错。  发送一个数据包，收到确认
    * 2.超时重传：发送一个数据包，等待大于往返时间后重新发送当前数据包
    * 3.确认丢失： 接收方收到数据包，并发出确认包，但确认包丢失，同样大于往返时间后重发  接收方收到后丢弃重复数据包
    * 4.确认迟到： 接收方收到数据包，并发出确认包，由于网络原因导致确认包迟到，重传
    * 自动重传请求协议， 简单 但是信道利用率低
  * 流水线传输 收到的确认总是以前发送的
    * 一次发送好多个数据包，接收方收到ABC后发送C的确认包
    * GO-BACK—N 连续ARQ协议
  * 累计确认
* SYN洪泛攻击
  * 攻击者不停发送SYN连接请求，但不会服务器的SYN确认，TCP连接处于挂起状态，服务器收到不到确认就会发送大量ack确认，消耗服务器CPU和内存
  * 解决办法  优化主机系统设置 如降低SYN timeout时间，
    * SYN cookie设置，如果短时间接收到某个IP的重复请求，就认为受到了该IP的攻击，丢弃该IP的后续请求报文。

##### TCP四次挥手

* ![image-20200301215400878](C:\Users\HYY\AppData\Roaming\Typora\typora-user-images\image-20200301215400878.png)
* 2MSL 
  * TIME-WAIT状态 目的 确保服务器顺利关闭，因为第三次挥手后服务器处于等待确认的过程，设置2MSL就是为了防止客户端发送的确认包，服务器没有收到而重发发送确认ACK包。

##### TCP和UDP的区别

* tcp是面向连接的、可靠的数据流传输，UDP是无连接的，不可靠的数据流传输。
* TCP传输单位为TCP报文段，而UDP传输单位为用户数据报。
* TCP注重数据安全性，而UDP传输速度快
* TCP支持点对点通信，UDP支持点对点，一对多，多对一，多对多的通信模式；
* TCP有拥塞控制，流量控制，UDP没有拥塞控制，适合媒体通信；

##### 流量控制

* 功能 防止发送发发送太快，接收方来不及接收
* 在建立TCP连接时接收方会发送自己的接收缓窗口大小，用于让发送方据此分配自己的发送窗口大小。
* 在发送方将发送窗口填满后，只有收到接收方的确认方可继续发送。以次实现流量控制
* O大小发送窗口  ：接收方每次发送确认时还可能发送调整发送窗口的字段，发送方据此调整发送窗口大小，若为0开启0窗口计时器，待计时器置零后，发送零窗口探测报文段(1个字节)
* 若确认仍为0，重启0窗口计时器。

##### 拥塞控制

* 若对网络中的某一资源的需求超过了该资源所能提高的部分，网络性能就要变坏，这种情况称为网络拥塞。
* 发送方根据自己估算的当前网络状况调整自己的拥塞窗口cwnd
* 算法：
  * 慢开始和拥塞避免：从1 开始 刚才是指数增长，后面线性增长 碰到拥塞重新从1开始指数增长到拥塞一半时，开始线性增长
  * 快重传和快恢复： 从1开始先指数增长，带ssthresh的时候线性增大，收到3个重复的确认后降到当前值的一般又开始线性增长。

### 会话层

* 功能 会话管理与数据传输同步
* 协议：
  * SQL
  * RPC  远程调用过程协议
  * AppleTalk  在客户机/服务器之间建立和维护会话。

### 表示层

* 为在应用过程之间传送的信息提供表示方法的服务
* 提供格式化的表示和转换数据服务。 数据的压缩，解压，加密，解密都在该层完成
* GIF  JPEG MPEG ASCII

### 应用层：

* 功能 进程间通信
* 协议：
  * FTP 文件传输协议 
    * 提供不同种类主机系统之间的文件传输能力
    * 端口  TCP控制连接端口21
      * 数据连接端口 主动 20  被动 > 1024
    * 传输模式 文本模式 二进制模式
  * SSH   远程连接协议 端口 22
  * TELNET   远程终端协议 端口 23
  * SMTP   邮件发送协议 端口 25  TCP协议
  * POP3 邮件接收协议 端口110
  * DNS   域名系统/域名解析协议 端口 53 TCP UDP 都有
    * 使用TCP的情况    会执行一次区域传送，进行数据同步。区域传送使用TCP而不是UDP，因为数据同步传送的数据量比一个请求应答的数据量要多得多。
    * 使用UDP  客户端向DNS服务器查询域名，一般地都返回都不超过512字节，使用UDP
  * HTTP  超文本传输协议 TCP  80
  * HTTPS  安全超文本传输协议 TCP 443

### cookie和session的区别：

* cookie: 位于用户计算机上，用来维护用户计算机中的信息，直到用户删除。
* session：会话信息，位于web服务器，主要负责访问者与网站之间的交互。
* cookie保存在客户端，而session保存在服务器
* cookie不是很安全，别人可以解析本地的cookie进行cookie欺骗，考虑安全该使用session
* session保存在服务器，如果访问过多，信息量过大，会影响服务器性能。
* 单个cookie保存的数据不能超过4k，而session大小没有限制只与服务器内存有关
* session的实现常依赖于cookie机制，通过cookie机制回传sessionID

### 长连接和短连接

* **长连接**也叫持久连接
  * 在运输层TCP协议握手成功后，不立即断开连接，并在次连接的基础上进行**多次消息交互**，直到一方主动断开连接，此过程称为一次完整的长连接
* **短连接**
  * 客户端收到服务端的响应后，**立刻发送FIN消息**，主动释放连接。
  * 凡是在**一次消息交互**(发请求-收响应)之后**立刻断开连接**的情况都称为短连接。
  * 短连接也是建立在TCP协议上的

* 维持长连接会有一定的系统开销，用户量少不容易看出系统瓶颈，一旦用户量上去了，就有可能把服务器资源耗尽























​	







